name: Check TrackTrending Enabled in Objects
on:
  pull_request:
    branches:
    - 'main'
jobs:
  Fetch-and-check-the-files:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Fetch all xml files
      run: |
        URL="https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}/files"
        FILES=$(curl -s -X GET -G $URL --header 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
               --header 'content-type: application/json' | jq '.[] | select(.filename | endswith(".xml")) | .filename')
        echo "$FILES"
        
    - name: Check for track trending enabled
      run: |
        while read -r file; do
          if grep -q "<trackTrending>false</trackTrending>" "$file"; then
            echo "$file contains trackTrending as enabled"
            exit 1
          else
            echo "$file does not contain trackTrending as enabled"
          fi
        done <<< "$FILES"
                        
      
